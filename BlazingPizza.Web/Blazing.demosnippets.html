<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Demo stuff</title>
    <!-- DEMOSNIPPETS-TAB Head -->
    <!-- DEMOSNIPPETS-LABEL Step 1 - Add Javascript -->
    <script src="./scripts/coolstuff.js"></script>
    <script language="javascript" src="./scripts/Logging.js"></script>
    <!-- DEMOSNIPPETS-LABEL Step 2 - Add CSS -->
    <link href="./assets/standard.css" />
    <!-- DEMOSNIPPETS-ENDSNIPPET -->
</head>
<body>
    <h1>Conference Demos</h1>
    <!-- DEMOSNIPPETS-TAB Body -->
    <!-- DEMOSNIPPETS-LABEL Step 3 - Add links -->
    <ul>
        <li>Home</li>
        <li>Store</li>
        <li>About</li>
        <li>Admin</li>
    </ul>
    <!-- DEMOSNIPPETS-LABEL Step 4 - Add text -->
    <p>Some important text to have on the page.</p>
    <!-- DEMOSNIPPETS-ENDSNIPPET -->

    <!--DEMOSNIPPETS-Label Step 5 - Add Fetch Partial -->
    <script type="text/javascript">
        function configurePizza(specialId) {
            var special = JSON.parse(document.getElementById(specialId).dataset.special);
            var targetBlock = document.getElementById('dialog') // locate the new html injection target
            var payload = new URLSearchParams(special).toString()

            fetch(`configureDialog?${payload}`, {
                method: 'get',
                credentials: "same-origin",
                headers: {
                    'Accept': 'text/html'
                }
            })
                .then(resp => resp.text())
                .then(data => {
                    targetBlock.innerHTML = data; // inject the received html block
                    targetBlock.querySelectorAll('script')  // find all injected script blocks and register them with the DOM
                        .forEach(scriptElem => {
                            var scriptBlock = document.createElement('script');
                            for (var i = 0; i < scriptElem.attributes.length; i++) {
                                var att = scriptElem.attributes[i];
                                scriptBlock.setAttribute(att.name, att.value);
                            }
                            scriptBlock.innerHTML = scriptElem.innerText;
                            targetBlock.appendChild(scriptBlock);
                            scriptElem.remove(); // remove the original inject, un-registered script block
                        })
                })
                .catch(err => { });
        }
    </script>
    <!--DEMOSNIPPETS-ENDSNIPPET -->
</body>
</html>